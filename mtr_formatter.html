<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>MTR (WinMTR) Formatter</title>
		<style type="text/css">
			body {float: left;}
			#noscript {color: red;}
			#form {display: none;}
      #mtr_table td {padding-left: 5px; padding-right: 5px;}
		</style>
	</head>
	<body>
		<noscript>
			<div id="noscript">
				<h1>This page uses JavaScript</h1>
				<p>Please, activate javascript in your browser or use other browser</p>
			</div>
		</noscript>

		<div id="form">
			
			<form name="form_input" onchange='updateTable()' onsubmit="updateTable(); return false;" style="float: left;">
				Input MTR (WinMTR) here:<br>
        <textarea name="text_in" style="width: 800px; height: 200px"></textarea>
			</form>

			<br>
		</div>

<table id="mtr_table" border="0">
</table>


<script>document.getElementById('form').style.display='block';</script>
<script type="text/javascript">


function updateTable() {
  //drop current content
  dropTable();
  
  //add new content
  var val = form_input.text_in.value;
  var arr = val.split(/\r?\n/);
  
  for (var i in arr) {
    arr[i]=arr[i].replace(/( [ ]+)+/g, ' ').replace(/^[ ]+/, '');
    

    // detect WinMTR format
    if (/.*\|.*\|.*/.test(arr[i])) {
     // alert(arr[i]);
      addRow(arr[i].replace(' - ', ' | ').replace(/ /g, '').replace(/(\-[\-]+)*/g,'').replace(/(_[_]+)*/g,'').replace(/\|/g, ' '));
    } else {
      addRow(arr[i]);
    }
  }
}

function addRow(line) {
  var table = document.getElementById("mtr_table");
  var rowCount = table.rows.length;
  var row = table.insertRow(rowCount);
  var colCount = table.rows[0].cells.length;
  var arr=line.split(' ');
  for (var i in arr) {
    var newcell = row.insertCell(-1);
    newcell.innerHTML = arr[i];
    if (i >= 2) {
      newcell.align = "right";
    }
    
    //alert(arr[i]);
  }
}

function dropTable(){
  var table = document.getElementById("mtr_table");
  table.innerHTML="";
}
</script>

	</body>
</html>
